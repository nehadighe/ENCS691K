"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.persistContext = exports.attachUsageData = exports.constructContext = void 0;
const context_1 = require("./domain/context");
const context_extensions_1 = require("./context-extensions");
const app_config_1 = require("./app-config");
const amplify_usageData_1 = require("./domain/amplify-usageData");
function constructContext(pluginPlatform, input) {
    const context = new context_1.Context(pluginPlatform, input);
    context_extensions_1.attachExtentions(context);
    return context;
}
exports.constructContext = constructContext;
function attachUsageData(context) {
    const { AMPLIFY_CLI_ENABLE_USAGE_DATA } = process.env;
    const config = app_config_1.init(context);
    const usageTrackingEnabled = AMPLIFY_CLI_ENABLE_USAGE_DATA
        ? AMPLIFY_CLI_ENABLE_USAGE_DATA === 'true'
        : config.usageDataConfig.isUsageTrackingEnabled;
    if (usageTrackingEnabled) {
        context.usageData = amplify_usageData_1.UsageData.Instance;
    }
    else {
        context.usageData = amplify_usageData_1.NoUsageData.Instance;
    }
    context.usageData.init(config.usageDataConfig.installationUuid, getVersion(context), context.input);
}
exports.attachUsageData = attachUsageData;
const getVersion = (context) => context.pluginPlatform.plugins.core[0].packageVersion;
function persistContext(context) {
}
exports.persistContext = persistContext;
//# sourceMappingURL=context-manager.js.map