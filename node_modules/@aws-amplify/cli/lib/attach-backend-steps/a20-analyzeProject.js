"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.analyzeProject = void 0;
const editor_selection_1 = require("../extensions/amplify-helpers/editor-selection");
const constants_1 = require("../extensions/amplify-helpers/constants");
const amplify_cli_core_1 = require("amplify-cli-core");
async function analyzeProject(context) {
    let defaultEditor = getDefaultEditor();
    if (!defaultEditor) {
        defaultEditor = await getEditor(context);
    }
    if ((context.exeInfo.inputParams && context.exeInfo.inputParams.yes) || context.parameters.options.forcePush) {
        context.exeInfo.forcePush = true;
    }
    else {
        context.exeInfo.forcePush = false;
    }
    context.exeInfo.projectConfig.version = constants_1.amplifyCLIConstants.PROJECT_CONFIG_VERSION;
    context.exeInfo.localEnvInfo.defaultEditor = defaultEditor;
    return context;
}
exports.analyzeProject = analyzeProject;
async function getEditor(context) {
    let editor;
    if (context.exeInfo.inputParams.amplify && context.exeInfo.inputParams.amplify.defaultEditor) {
        editor = editor_selection_1.normalizeEditor(context.exeInfo.inputParams.amplify.defaultEditor);
    }
    else if (!context.exeInfo.inputParams.yes) {
        editor = await editor_selection_1.editorSelection(editor);
    }
    return editor;
}
function getDefaultEditor() {
    const projectPath = process.cwd();
    const localEnvInfo = amplify_cli_core_1.stateManager.getLocalEnvInfo(projectPath, {
        throwIfNotExist: false,
        default: {},
    });
    return localEnvInfo.defaultEditor;
}
//# sourceMappingURL=a20-analyzeProject.js.map